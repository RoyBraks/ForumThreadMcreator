Hello guys,



Im trying to make certain structures spawn in a custom superflat dimension. This is the code for the dimension:

{
    "type": "backrooms:level_1_dim",
    "generator": {
        "type": "minecraft:flat",
        "settings": {
            "biome": "backrooms:level_1",
            "lakes": false,
            "features": false,
            "layers": [
                {
                    "block": "backrooms:level_1_concrete_floor",
                    "height": 1
                },
                {
                    "block": "minecraft:void_air",
                    "height": 3
                },
                {
                    "block": "backrooms:level_1_concrete_floor",
                    "height": 2
                },
                {
                    "block": "minecraft:void_air",
                    "height": 3
                },
                {
                    "block": "backrooms:level_1_concrete_floor",
                    "height": 2
                },
                {
                    "block": "minecraft:void_air",
                    "height": 3
                },
                {
                    "block": "backrooms:level_1_concrete_floor",
                    "height": 2
                },
                {
                    "block": "minecraft:void_air",
                    "height": 3
                },
                {
                    "block": "backrooms:level_1_concrete_floor",
                    "height": 2
                },
                {
                    "block": "minecraft:void_air",
                    "height": 3
                },
                {
                    "block": "backrooms:level_1_concrete_floor",
                    "height": 2
                },
                {
                    "block": "minecraft:void_air",
                    "height": 3
                },
                {
                    "block": "backrooms:level_1_concrete_floor",
                    "height": 1
                }
            ],
            "structures": {
                "structures": {}
            }
        }
    }
}


And the java;

import net.minecraftforge.registries.ForgeRegistries;
import net.minecraftforge.fml.event.lifecycle.FMLCommonSetupEvent;
import net.minecraftforge.fml.event.lifecycle.FMLClientSetupEvent;
import net.minecraftforge.fml.common.Mod;
import net.minecraftforge.eventbus.api.SubscribeEvent;
import net.minecraftforge.api.distmarker.OnlyIn;
import net.minecraftforge.api.distmarker.Dist;

import net.minecraft.world.phys.Vec3;
import net.minecraft.world.level.levelgen.carver.WorldCarver;
import net.minecraft.world.level.block.Blocks;
import net.minecraft.world.level.block.Block;
import net.minecraft.resources.ResourceLocation;
import net.minecraft.client.renderer.DimensionSpecialEffects;

import java.util.Set;
import java.util.HashSet;

import com.google.common.collect.ImmutableSet;

@Mod.EventBusSubscriber
public class Level1DimDimension {
    @Mod.EventBusSubscriber(bus = Mod.EventBusSubscriber.Bus.MOD)
    public static class Fixers {
        @SubscribeEvent
        public static void registerFillerBlocks(FMLCommonSetupEvent event) {
            Set<Block> replaceableBlocks = new HashSet<>();
            replaceableBlocks.add(Blocks.AIR);
            replaceableBlocks.add(ForgeRegistries.BIOMES.getValue(new ResourceLocation("backrooms:level_1")).getGenerationSettings()
                    .getSurfaceBuilder().get().config().getTopMaterial().getBlock());
            replaceableBlocks.add(ForgeRegistries.BIOMES.getValue(new ResourceLocation("backrooms:level_1")).getGenerationSettings()
                    .getSurfaceBuilder().get().config().getUnderMaterial().getBlock());
            event.enqueueWork(() -> {
                WorldCarver.CAVE.replaceableBlocks = new ImmutableSet.Builder<Block>().addAll(WorldCarver.CAVE.replaceableBlocks)
                        .addAll(replaceableBlocks).build();
                WorldCarver.CANYON.replaceableBlocks = new ImmutableSet.Builder<Block>().addAll(WorldCarver.CANYON.replaceableBlocks)
                        .addAll(replaceableBlocks).build();
            });
        }

        @SubscribeEvent
        @OnlyIn(Dist.CLIENT)
        public static void registerDimensionSpecialEffects(FMLClientSetupEvent event) {
            DimensionSpecialEffects customEffect = new DimensionSpecialEffects(Float.NaN, true, DimensionSpecialEffects.SkyType.NONE, false, false) {
                @Override
                public Vec3 getBrightnessDependentFogColor(Vec3 color, float sunHeight) {
                    return new Vec3(0.4, 0.4, 0.4);
                }

                @Override
                public boolean isFoggyAt(int x, int y) {
                    return true;
                }
            };
            event.enqueueWork(() -> DimensionSpecialEffects.EFFECTS.put(new ResourceLocation("backrooms:level_1_dim"), customEffect));
        }
    }
}


This is the code for the structure that im trying to spawn:

package net.mcreator.backrooms.world.features;

import net.minecraft.world.level.levelgen.structure.templatesystem.StructureTemplate;
import net.minecraft.world.level.levelgen.structure.templatesystem.StructurePlaceSettings;
import net.minecraft.world.level.levelgen.structure.templatesystem.BlockIgnoreProcessor;
import net.minecraft.world.level.levelgen.feature.configurations.NoneFeatureConfiguration;
import net.minecraft.world.level.levelgen.feature.configurations.FeatureConfiguration;
import net.minecraft.world.level.levelgen.feature.FeaturePlaceContext;
import net.minecraft.world.level.levelgen.feature.Feature;
import net.minecraft.world.level.levelgen.feature.ConfiguredFeature;
import net.minecraft.world.level.levelgen.Heightmap;
import net.minecraft.world.level.block.Rotation;
import net.minecraft.world.level.block.Mirror;
import net.minecraft.world.level.WorldGenLevel;
import net.minecraft.world.level.Level;
import net.minecraft.resources.ResourceLocation;
import net.minecraft.resources.ResourceKey;
import net.minecraft.core.Registry;
import net.minecraft.core.BlockPos;

import net.mcreator.backrooms.procedures.Level1pillarsAdditionalGenerationConditionProcedure;

import java.util.Set;

public class Level1pillarsFeature extends Feature<NoneFeatureConfiguration> {
    public static final Level1pillarsFeature FEATURE = (Level1pillarsFeature) new Level1pillarsFeature().setRegistryName("backrooms:level_1pillars");
    public static final ConfiguredFeature<?, ?> CONFIGURED_FEATURE = FEATURE.configured(FeatureConfiguration.NONE);
    public static final Set<ResourceLocation> GENERATE_BIOMES = null;
    private StructureTemplate template = null;

    public Level1pillarsFeature() {
        super(NoneFeatureConfiguration.CODEC);
    }

    @Override
    public boolean place(FeaturePlaceContext<NoneFeatureConfiguration> context) {
        boolean dimensionCriteria = false;
        ResourceKey<Level> dimensionType = context.level().getLevel().dimension();
        if (dimensionType == ResourceKey.create(Registry.DIMENSION_REGISTRY, new ResourceLocation("backrooms:level_1_dim")))
            dimensionCriteria = true;
        if (!dimensionCriteria)
            return false;
        if (template == null)
            template = context.level().getLevel().getStructureManager().getOrCreate(new ResourceLocation("backrooms", "level1pillars"));
        if (template == null)
            return false;
        if ((context.random().nextInt(1000000) + 1) <= 1000000) {
            boolean anyPlaced = false;
            int count = context.random().nextInt(2) + 15;
            for (int a = 0; a < count; a++) {
                int i = context.origin().getX() + context.random().nextInt(16);
                int k = context.origin().getZ() + context.random().nextInt(16);
                int j = context.level().getHeight(Heightmap.Types.WORLD_SURFACE_WG, i, k);
                j -= 1;
                BlockPos spawnTo = new BlockPos(i + 0, j + 1, k + 0);
                WorldGenLevel world = context.level();
                int x = spawnTo.getX();
                int y = spawnTo.getY();
                int z = spawnTo.getZ();
                if (!Level1pillarsAdditionalGenerationConditionProcedure.execute(x, z))
                    continue;
                if (template.placeInWorld(
                        context.level(), spawnTo, spawnTo, new StructurePlaceSettings().setMirror(Mirror.NONE).setRotation(Rotation.NONE)
                                .setRandom(context.random()).addProcessor(BlockIgnoreProcessor.STRUCTURE_AND_AIR).setIgnoreEntities(false),
                        context.random(), 2)) {
                    anyPlaced = true;
                }
            }
            return anyPlaced;
        }
        return false;
    }
}
This is the biome in the dimension:

package net.mcreator.backrooms.world.biome;

import net.minecraftforge.common.BiomeDictionary;

import net.minecraft.world.level.levelgen.surfacebuilders.SurfaceBuilderBaseConfiguration;
import net.minecraft.world.level.levelgen.surfacebuilders.SurfaceBuilder;
import net.minecraft.world.level.levelgen.surfacebuilders.ConfiguredSurfaceBuilder;
import net.minecraft.world.level.biome.MobSpawnSettings;
import net.minecraft.world.level.biome.BiomeSpecialEffects;
import net.minecraft.world.level.biome.BiomeGenerationSettings;
import net.minecraft.world.level.biome.Biome;
import net.minecraft.world.level.biome.AmbientParticleSettings;
import net.minecraft.sounds.SoundEvent;
import net.minecraft.resources.ResourceLocation;
import net.minecraft.resources.ResourceKey;
import net.minecraft.data.BuiltinRegistries;
import net.minecraft.core.particles.ParticleTypes;
import net.minecraft.core.Registry;

import net.mcreator.backrooms.init.BackroomsModBlocks;
import net.mcreator.backrooms.init.BackroomsModBiomes;
import net.mcreator.backrooms.BackroomsMod;

public class Level1Biome {
    private static final ConfiguredSurfaceBuilder<?> SURFACE_BUILDER = SurfaceBuilder.DEFAULT
            .configured(new SurfaceBuilderBaseConfiguration(BackroomsModBlocks.LEVEL_1_CONCRETE_FLOOR.defaultBlockState(),
                    BackroomsModBlocks.LEVEL_1_CONCRETE_FLOOR.defaultBlockState(), BackroomsModBlocks.LEVEL_1_CONCRETE_FLOOR.defaultBlockState()));

    public static Biome createBiome() {
        BiomeSpecialEffects effects = new BiomeSpecialEffects.Builder().fogColor(-3355444).waterColor(4159204).waterFogColor(329011)
                .skyColor(-3355444).foliageColorOverride(10387789).grassColorOverride(9470285)
                .ambientLoopSound(new SoundEvent(new ResourceLocation("backrooms:ambiencelvl1")))
                .ambientParticle(new AmbientParticleSettings(ParticleTypes.FALLING_WATER, 0.001f)).build();
        BiomeGenerationSettings.Builder biomeGenerationSettings = new BiomeGenerationSettings.Builder().surfaceBuilder(SURFACE_BUILDER);
        MobSpawnSettings.Builder mobSpawnInfo = new MobSpawnSettings.Builder().setPlayerCanSpawn();
        return new Biome.BiomeBuilder().precipitation(Biome.Precipitation.NONE).biomeCategory(Biome.BiomeCategory.PLAINS).depth(1f).scale(0f)
                .temperature(0.5f).downfall(0f).specialEffects(effects).mobSpawnSettings(mobSpawnInfo.build())
                .generationSettings(biomeGenerationSettings.build()).build();
    }

    public static void init() {
        Registry.register(BuiltinRegistries.CONFIGURED_SURFACE_BUILDER, new ResourceLocation(BackroomsMod.MODID, "level_1"), SURFACE_BUILDER);
        BiomeDictionary.addTypes(ResourceKey.create(Registry.BIOME_REGISTRY, BuiltinRegistries.BIOME.getKey(BackroomsModBiomes.LEVEL_1)),
                BiomeDictionary.Type.PLAINS);
    }
}


The dimension and biome spawn good because the dimension has the right blocks at the right place and the particles and the music place from the biome. But the structures don't spawn. I've tried to fiend a solution but I cannot find one that I can use and understand. It would be appreciated if you can help me!





